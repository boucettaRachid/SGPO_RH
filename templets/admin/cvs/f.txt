<?php
require '../../Model/admin/StagiaireModel.php';


class StagiaireController {
    // Méthode pour créer un nouveau stagiaire
    public function createStagiaire() {
        // Vérifier si le formulaire a été soumis
        if (!empty($_POST)) {
            $id_admin = !empty($_POST['ID_admin']) ? $_POST['ID_admin'] : null;
            $name = isset($_POST['Name']) ? $_POST['Name'] : '';
            $prenom = isset($_POST['Prenom']) ? $_POST['Prenom'] : '';
            $cin = isset($_POST['Cin']) ? $_POST['Cin'] : '';
            $address = isset($_POST['Address']) ? $_POST['Address'] : '';
            $email = isset($_POST['Email']) ? $_POST['Email'] : '';
            $image = isset($_FILES['Image']) ? $_FILES['Image']['name'] : '';
            $image_tmp = isset($_FILES['Image']) ? $_FILES['Image']['tmp_name'] : '';
            $tele = isset($_POST['Tele']) ? $_POST['Tele'] : '';
            $cv = isset($_FILES['Cv']) ? $_FILES['Cv']['name'] : '';
            $cv_tmp = isset($_FILES['Cv']) ? $_FILES['Cv']['tmp_name'] : '';
            $username = isset($_POST['Username']) ? $_POST['Username'] : '';
            $password = isset($_POST['Password']) ? $_POST['Password'] : '';
            $mission = isset($_POST['Mission']) ? $_POST['Mission'] : '';
            $type_stage = isset($_POST['Type_stage']) ? $_POST['Type_stage'] : '';
            $date_D = isset($_POST['Date_D']) ? $_POST['Date_D'] : date('Y-m-d');
            $date_F = isset($_POST['Date_F']) ? $_POST['Date_F'] : date('Y-m-d');

            // Upload image file
            move_uploaded_file($image_tmp, "../../templets/admin/images/$image");

            // Upload CV file
            move_uploaded_file($cv_tmp, "../../templets/admin/cvs/$cv");

            $data = [$id_admin, $name, $prenom, $cin, $address, $email, $image, $tele, $cv, $username, $password, $mission, $type_stage, $date_D, $date_F];

            $model = new StagiaireModel();
            $model->createStagiaire($data);
         
            $msg = 'Created Successfully!';
            header('Location: ../../templets/admin/index.php');
            exit;
        }
        // Afficher le formulaire de création du stagiaire
        include '../../templets/admin/createStagiaire.php';
    }


    public function getAllStagiaires() {
        // Instancier l'objet StagiaireModel
        $stagiaireModel = new StagiaireModel();

        // Appeler la méthode getAllStagiaires de StagiaireModel pour récupérer tous les stagiaires
        $stagiaires = $stagiaireModel->getAllStagiaires();

        // Vérifier s'il y a des stagiaires trouvés
        if (empty($stagiaires)) {
            echo "No stagiaires found.";
        } else {
            // Afficher la liste de tous les stagiaires
            include '../../templets/admin/listStagiaire.php';
           
        }
    }



// Méthode pour récupérer un stagiaire par son ID
public function getStagiaireById($stagiaire) {
    // Instancier l'objet StagiaireModel
    $stagiaireModel = new StagiaireModel();

    // Appeler la méthode getStagiaireById de StagiaireModel pour récupérer les données du stagiaire par son ID
    $stagiaire = $stagiaireModel->getStagiaireById($stagiaire);

    // Afficher les détails du stagiaire
    include '../../templets/admin/deletStagiaire.php';
}

// Méthode pour mettre à jour les informations d'un stagiaire
public function updateStagiaire($stagiaireId) {
    // Vérifier si le formulaire a été soumis
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        // Valider les données du formulaire (vous pouvez ajouter des validations supplémentaires)
        $data = [
            $_POST['Name'],
            $_POST['Prenom'],
            $_POST['Cin'],
            $_POST['Address'],
            $_POST['Email'],
            $_POST['Image'],
            $_POST['Tele'],
            $_POST['Cv'],
            $_POST['Username'],
            $_POST['Password'],
            $_POST['Mission'],
            $_POST['Type_stage'],
            $_POST['Date_D'],
            $_POST['Date_F']
        ];

        // Instancier l'objet StagiaireModel
        $stagiaireModel = new StagiaireModel();

        // Appeler la méthode updateStagiaire de StagiaireModel pour mettre à jour les données du stagiaire
        $stagiaireModel->updateStagiaire($stagiaireId, $data);

        // Rediriger vers une page de confirmation ou de liste des stagiaires, par exemple :
        header('Location: confirmation.php');
        exit;
    }

    // Récupérer les informations du stagiaire à partir de l'ID et afficher le formulaire de mise à jour
    $stagiaireModel = new StagiaireModel();
    $stagiaire = $stagiaireModel->getStagiaireById($stagiaire);
    include '../../templets/admin/updateStagiaire.php'; 
}

public function deleteStagiaire($stagiaireId) {
    // Vérifier si le formulaire a été soumis
    if ($_SERVER['REQUEST_METHOD'] === 'POST') {
        // Instancier l'objet StagiaireModel
        $stagiaireModel = new StagiaireModel();

        // Appeler la méthode deleteStagiaire de StagiaireModel pour supprimer le stagiaire par son ID
        $stagiaireModel->deleteStagiaire($stagiaireId);

        // Rediriger vers une page de confirmation ou de liste des stagiaires, par exemple :
        header('Location: confirmation.php');
        exit;
    }

    include '../../templets/admin/delete_stagiaire_confirmation.php';
}
}
<?php
// StagiaireModel.php

require '../../setting/db.php';

class StagiaireModel {
    public function createStagiaire($data) {
        $pdo = pdo_connect_mysql();

        $stmt = $pdo->prepare('INSERT INTO stagiaire (ID_admin, Name, Prenom, Cin, Address, Email, Image, Tele, Cv, Username, Password, Mission, Type_stage, Date_D, Date_F) VALUES (?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?, ?)');
        $stmt->execute($data);
    }
  
    public function getStagiaireById($stagiaireId) {
        $pdo = pdo_connect_mysql();
        $stmt = $pdo->prepare('SELECT * FROM stagiaire WHERE ID = ?');
        $stmt->execute([$stagiaire]);
        return $stmt->fetch(PDO::FETCH_ASSOC);
    }

    public function getAllStagiaires() {
        $pdo = pdo_connect_mysql();
        $stmt = $pdo->query('SELECT * FROM stagiaire');
        return $stmt->fetchAll(PDO::FETCH_ASSOC);
    }

    public function updateStagiaire($stagiaireId, $data) {
        $pdo = pdo_connect_mysql();
        $stmt = $pdo->prepare('UPDATE stagiaire SET Name = ?, Prenom = ?, Cin = ?, Address = ?, Email = ?, Image = ?, Tele = ?, Cv = ?, Username = ?, Password = ?, Mission = ?, Type_stage = ?, Date_D = ?, Date_F = ? WHERE ID = ?');
        $data[] = $stagiaireId;
        $stmt->execute($data);
    }
    
    public function deleteStagiaire($stagiaireId) {
        $pdo = pdo_connect_mysql();
        $stmt = $pdo->prepare('DELETE FROM stagiaire WHERE ID = ?');
        $stmt->execute([$stagiaireId]);
    }
}
?><?php
// Include necessary files and classes
require '../../controle/admin/StagiaireController.php';

// Create an instance of the StagiaireController class
$controller = new StagiaireController();

// Check for actions (e.g., creating, updating, deleting) and handle accordingly
if (isset($_GET['action'])) {
    $action = $_GET['action'];

    switch ($action) {
        case 'create':
            $controller->createStagiaire();
            break;
        case 'update':
            $stagiaireId = $_GET['id'];
            $controller->updateStagiaire($stagiaireId);
            break;
        case 'delete':
            $stagiaireId = $_GET['id'];
            $controller->deleteStagiaire($stagiaireId);
            break;
        default:
            // Handle other actions or show a default view
            break;
    }
} else {
    // Show the list of all stagiaires (view all)
    $controller->getAllStagiaires();
}
?>

